<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualizar Catálogo</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .log { background: #f0f0f0; padding: 10px; border-radius: 5px; max-height: 400px; overflow-y: auto; margin: 10px 0; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        textarea { width: 100%; height: 300px; }
    </style>
</head>
<body>
    <h1>Atualizar Catálogo 2025</h1>
    <button onclick="scanAndUpdate()">Escanear data/indicadores/2025 e Atualizar Catálogo</button>
    <div class="log" id="log"></div>
    <h3>Catálogo Gerado:</h3>
    <textarea id="output"></textarea>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script>
        const log = (msg) => {
            const el = document.getElementById('log');
            el.textContent += msg + '\n';
            el.scrollTop = el.scrollHeight;
        };

        async function scanAndUpdate() {
            log('Iniciando scan de indicadores...');
            try {
                const resp = await fetch('data/indicadores/2025/', { method: 'GET' });
                // Não funciona por CORS. Vamos fazer manual.
                log('⚠ Scan automático não funciona (CORS). Use o método manual abaixo.');
            } catch (e) {
                log('❌ Erro: ' + e.message);
            }
        }

        // Catálogo manual baseado nos arquivos criados
        const manualCatalog = {
            "demografia": [
                {
                    "slug": "demo-pop-total",
                    "label": "População Total - Estimativas Populacionais e Censo Demográfico (2021 a 2025)",
                    "unit": "hab",
                    "year": 2025,
                    "path": "data/indicadores/2025/Tab 1.1 População Total - Estimativas Populacionais e Censo Demográfico - 2021 a 2025.json"
                },
                {
                    "slug": "demo-pop-faixa-etaria",
                    "label": "População por Faixa Etária (2021 a 2025)",
                    "unit": "hab",
                    "year": 2025,
                    "path": "data/indicadores/2025/Tab 1.2 População por Faixa Etária - 2021 a 2025.json"
                },
                {
                    "slug": "demo-pop-sexo",
                    "label": "População por Sexo (2021 a 2025)",
                    "unit": "hab",
                    "year": 2025,
                    "path": "data/indicadores/2025/Tab 1.3 População por Sexo - 2021 a 2025.json"
                },
                {
                    "slug": "demo-razao-sexos",
                    "label": "Razão de Sexos (2021 a 2025)",
                    "unit": "",
                    "year": 2025,
                    "path": "data/indicadores/2025/Tab 1.4 Razão de Sexos - 2021 a 2025.json"
                },
                {
                    "slug": "demo-proporcao-idosos",
                    "label": "Proporção de Idosos (2021 a 2025)",
                    "unit": "%",
                    "year": 2025,
                    "path": "data/indicadores/2025/Tab 1.5 Proporção de Idosos - 2021 a 2025.json"
                },
                {
                    "slug": "demo-indice-envelhecimento",
                    "label": "Índice de Envelhecimento (2021 a 2025)",
                    "unit": "",
                    "year": 2025,
                    "path": "data/indicadores/2025/Tab 1.6 Índice de Envelhecimento - 2021 a 2025.json"
                },
                {
                    "slug": "demo-razao-dependencia",
                    "label": "Razão de Dependência (2021 a 2025)",
                    "unit": "",
                    "year": 2025,
                    "path": "data/indicadores/2025/Tab 1.7 Razão de Dependência - 2021 a 2025.json"
                },
                {
                    "slug": "demo-taxa-fecundidade",
                    "label": "Taxa de Fecundidade Total (2020 a 2024)",
                    "unit": "",
                    "year": 2024,
                    "path": "data/indicadores/2025/Tab 1.8 Taxa de Fecundidade Total - 2020 a 2024.json"
                },
                {
                    "slug": "demo-taxa-fec-faixa",
                    "label": "Taxa Específica de Fecundidade por faixa etária (2020 a 2024)",
                    "unit": "",
                    "year": 2024,
                    "path": "data/indicadores/2025/Tab 1.9 Taxa Específica de Fecundidade por faixa etária - 2020 a 2024.json"
                }
            ],
            "economia": [],
            "infraestrutura": [],
            "meio-ambiente": [],
            "social": []
        };

        document.body.innerHTML += `
            <h3>Catálogo Manual Configurado</h3>
            <button onclick="downloadCatalog()">Baixar Catálogo</button>
            <button onclick="copyCatalog()">Copiar para Área de Transferência</button>
        `;

        window.catalogData = manualCatalog;

        function downloadCatalog() {
            const json = JSON.stringify(manualCatalog, null, 2);
            document.getElementById('output').value = json;
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'catalogo_2025.json';
            a.click();
            URL.revokeObjectURL(url);
            log('✅ Catálogo baixado como catalogo_2025.json');
        }

        function copyCatalog() {
            const json = JSON.stringify(manualCatalog, null, 2);
            document.getElementById('output').value = json;
            document.getElementById('output').select();
            document.execCommand('copy');
            log('✅ Catálogo copiado para a área de transferência');
        }

        // Mostra na tela ao carregar
        window.addEventListener('load', () => {
            const json = JSON.stringify(manualCatalog, null, 2);
            document.getElementById('output').value = json;
            log('✅ Catálogo manual carregado. Clique em "Baixar Catálogo" para salvar.');
        });
    </script>
</body>
</html>
